"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=function(e){return e.getParam("dimageChoose",{},"object")},n=function(e){return e.getParam("dimageOptions",{},"object")},o=function(e){return e.getParam("dimageUploader",null,"function")},i={dimageChoose:t,dimageOptions:n,dimageUploader:o},r=function(e){var t=i.dimageChoose(e),n=i.dimageOptions(e),o=i.dimageUploader(e);if(o&&""==(t.uploadUrl||""))return e.notificationManager.open({text:"UploadUrl is undefined",type:"error",closeButton:!1,timeout:3e3});$.admin.layer.image(t,n,function(n,i){var r,a,m=function(m){r=m;var c=function(t){$.admin.layer.close(n),t instanceof Blob||t instanceof String?e.insertContent('<img src="'+("object"==(void 0===t?"undefined":_typeof(t))?URL.createObjectURL(t):t)+'">'):"object"==(void 0===t?"undefined":_typeof(t))&&$.each(t,function(t,n){e.insertContent('<img src="'+n+'">')})};(a=o?o(t.uploadUrl,r,i,c):r)&&($.admin.layer.close(n),e.insertContent('<img src="'+("object"==(void 0===a?"undefined":_typeof(a))?URL.createObjectURL(a):a)+'">'))};if(t.cropper){var c=["width","height","minWidth","minHeight","maxWidth","maxHeight"],d={};for(var u in t)t[u]>0&&-1!=c.indexOf(u)&&(d[u]=t[u]);t.base64?m(i.cropper.getCroppedCanvas(d).toDataURL(i.info.mime,t.cropper.quality||.9)):i.cropper.getCroppedCanvas(d).toBlob(m,i.info.mime,t.cropper.quality||.9)}else m(i.result)})},a=function(e){e.addCommand("mceDimage",function(){r(e)})},m={register:a},c=function(e){e.ui.registry.addButton("dimage",{icon:"image",tooltip:"Insert/edit image",onAction:function(){return e.execCommand("mceDimage")}}),e.ui.registry.addMenuItem("dimage",{icon:"image",text:"Image...",onAction:function(){return e.execCommand("mceDimage")}})},d={register:c};!function(){e.add("dimage",function(e){setTimeout(function(){e.dom.addStyle("p img {max-width:100%}")}),m.register(e),d.register(e)})}()}();
